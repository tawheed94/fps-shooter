<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>FPS Training Grounds</title>
  <style>
    body { margin: 0; overflow: hidden; background: #000; }
    canvas { display: block; }
    #crosshair {
      position: fixed;
      top: 50%; left: 50%;
      transform: translate(-50%, -50%);
      width: 20px; height: 20px;
      pointer-events: none;
      z-index: 10;
    }
    #crosshair:before, #crosshair:after {
      content: '';
      position: absolute;
      background: white;
    }
    #crosshair:before {
      left: 9px; top: 0; width: 2px; height: 20px;
    }
    #crosshair:after {
      left: 0; top: 9px; width: 20px; height: 2px;
    }
    .btn {
      position: fixed;
      background: rgba(255,255,255,0.2);
      border: 2px solid white;
      border-radius: 8px;
      color: white;
      text-align: center;
      line-height: 40px;
      width: 40px; height: 40px;
      user-select: none;
      z-index: 20;
    }
    #up { bottom: 100px; left: 60px; }
    #down { bottom: 20px; left: 60px; }
    #left { bottom: 60px; left: 20px; }
    #right { bottom: 60px; left: 100px; }
    #shoot { bottom: 60px; right: 40px; width: 60px; height: 60px; line-height: 60px; }
  </style>
</head>
<body>
  <div id="crosshair"></div>
  <!-- Mobile Controls -->
  <div id="up" class="btn">â–²</div>
  <div id="down" class="btn">â–¼</div>
  <div id="left" class="btn">â—€</div>
  <div id="right" class="btn">â–¶</div>
  <div id="shoot" class="btn">ðŸ”¥</div>

  <script src="https://cdn.jsdelivr.net/npm/three@0.152.2/build/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.152.2/examples/js/controls/PointerLockControls.js"></script>
  <script>
    // Scene setup
    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
    const renderer = new THREE.WebGLRenderer();
    renderer.setSize(window.innerWidth, window.innerHeight);
    document.body.appendChild(renderer.domElement);

    // Lighting
    scene.add(new THREE.HemisphereLight(0xffffff, 0x444444, 1));

    // Ground
    const ground = new THREE.Mesh(new THREE.PlaneGeometry(200,200), new THREE.MeshPhongMaterial({color:0x228822}));
    ground.rotation.x = -Math.PI/2;
    scene.add(ground);

    // Controls
    const controls = new THREE.PointerLockControls(camera, document.body);
    document.body.addEventListener('click', () => controls.lock());
    camera.position.y = 2;

    const velocity = new THREE.Vector3();
    const keys = {};

    document.addEventListener('keydown', e => keys[e.code] = true);
    document.addEventListener('keyup', e => keys[e.code] = false);

    // Mobile state
    const mobile = {up:false, down:false, left:false, right:false};

    // Training dummies
    const dummies = [];
    const dummyGeo = new THREE.BoxGeometry(1,2,1);
    const dummyMat = new THREE.MeshPhongMaterial({color:0xff0000});
    for (let i=0;i<30;i++) {
      const dummy = new THREE.Mesh(dummyGeo, dummyMat.clone());
      dummy.position.set((Math.random()-0.5)*180,1,(Math.random()-0.5)*180);
      scene.add(dummy);
      dummies.push(dummy);
    }

    // Bullets
    const bullets = [];
    function shoot() {
      const bullet = new THREE.Mesh(
        new THREE.SphereGeometry(0.1,8,8),
        new THREE.MeshBasicMaterial({color:0xffff00})
      );
      bullet.position.copy(camera.position);
      bullet.quaternion.copy(camera.quaternion);
      bullet.velocity = new THREE.Vector3(0,0,-1).applyQuaternion(camera.quaternion).multiplyScalar(1);
      scene.add(bullet);
      bullets.push(bullet);
    }
    document.addEventListener('mousedown', e => {
      if (e.button === 0) shoot(); // left click
    });

    // Aim down sights (right click)
    let aiming = false;
    document.addEventListener('contextmenu', e => e.preventDefault()); // disable browser menu
    document.addEventListener('mousedown', e => {
      if (e.button === 2) { // right click
        aiming = true;
        camera.fov = 40; // zoom in
        camera.updateProjectionMatrix();
      }
    });
    document.addEventListener('mouseup', e => {
      if (e.button === 2) {
        aiming = false;
        camera.fov = 75; // reset zoom
        camera.updateProjectionMatrix();
      }
    });

    // Mobile buttons
    function bindButton(id, prop) {
      const el = document.getElementById(id);
      el.addEventListener('touchstart', e => { e.preventDefault(); mobile[prop] = true; });
      el.addEventListener('touchend', e => { e.preventDefault(); mobile[prop] = false; });
    }
    bindButton("up","up"); bindButton("down","down");
    bindButton("left","left"); bindButton("right","right");
    document.getElementById("shoot").addEventListener('touchstart', e => { e.preventDefault(); shoot(); });

    // Animation
    const clock = new THREE.Clock();
    function animate() {
      const delta = clock.getDelta();

      // Player movement
      velocity.set(0,0,0);
      if (keys['KeyW'] || mobile.up) velocity.z -= 5 * delta;
      if (keys['KeyS'] || mobile.down) velocity.z += 5 * delta;
      if (keys['KeyA'] || mobile.left) velocity.x -= 5 * delta;
      if (keys['KeyD'] || mobile.right) velocity.x += 5 * delta;

      controls.moveRight(velocity.x);
      controls.moveForward(velocity.z);

      // Bullets
      for (let i=bullets.length-1;i>=0;i--) {
        const b = bullets[i];
        b.position.add(b.velocity.clone().multiplyScalar(20*delta));
        if (b.position.length()>300) { scene.remove(b); bullets.splice(i,1); continue; }
        for (let j=dummies.length-1;j>=0;j--) {
          if (b.position.distanceTo(dummies[j].position)<1) {
            scene.remove(dummies[j]);
            dummies.splice(j,1);
            scene.remove(b);
            bullets.splice(i,1);
            break;
          }
        }
      }

      renderer.render(scene,camera);
      requestAnimationFrame(animate);
    }
    animate();

    window.addEventListener('resize', () => {
      camera.aspect = window.innerWidth / window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight);
    });
  </script>
</body>
</html>
